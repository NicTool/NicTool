
To upgrade NicTool to v2.10+, the following steps should be taken:

1. shut down export processes (stop DNS server updates)
     # $local/etc/rc.d/svscan stop
            or
     # service svscan stop  (or: initctl stop svscan)

2. shut down web/nictool server (prevent DB changes)
     $ $local/etc/rc.d/apache22 stop
            or
     # service httpd stop

3. install NicTool client & server
     https://github.com/msimerson/NicTool/wiki/Install-NicToolClient
     https://github.com/msimerson/NicTool/wiki/Install-NicToolServer

     Note the default path changes and apply them as shown.

4. run the database migration scripts
     # cd /usr/local/nictool/server
     # sql/upgrade.pl

5. start up web server & validate

6. install any new dependencies
    cd /usr/local/nictool/server
    ./bin/nt_install_deps.pl

# Creating new exports is necessary when upgrading to NicTool 2.10. It is not
# necessary on upgrades after 2.11.

7. create new exports
    # cd /usr/local/nictool
    # mkdir ns1.example.com
    # cd ns1.example.com
    # ln -s ../server/bin/nt_export.pl .
    # ./nt_export.pl -nsid N  (run without a NSID to see a list)
    # chown -R nictool data-*

After a successful export, this last step will leave behind:
  1. 'run' file
  2. data directory with the exported data file(s).
  3. a Makefile, customized for the NS type, any compilation needed, and rsyncing the data file(s) to the right place. If the settings are incorrect, just edit the Makefile. To customize the export (to rsync to multiple servers, or different servers, or via private IPs, or whatever), edit the Makefile.

    # ./run  (test the run file)

Since this is an upgrade, presumably you already have an existing run file, export users, and ssh keys all set up. If so, this should "just work."

    # vi run

Once you have successfully run the export, edit the run file and select a daemon or cron entry. The run file has instructions within.

    # ln -s /usr/local/nictool/ns1.example.com /service/

Tell svscan to start up this daemon.


    SIGNIFICANT DIFFERENCES FROM PRE-v2.10 EXPORT SCRIPT

SPEED: The old export scripts used a c++ application to dump the data from MySQL to the data file. The new exports are pure perl. Most NicTool users have hundreds or thousands of domains. They won't notice the difference. My DB exports complete in under a second.

On a NicTool install with 152,803 domains and 1.2 million RRs, it might hypothetically take 54 seconds to do a full export. On a dual core E8400 @ 3GHz. The old exports completed that same export in 18 seconds. Some export testing on a snapshot of your data may be worth doing before upgrading. There is no sql/downgrade script.

DATA FILE:

I discovered these differences by doing a diff on a 'data' file exported using the old export scripts to one generated by the new export scripts. I suggest you do the same. Pipe them both through sort first, and then diff or diff -y reveals all.

* A zone with no defined resource records now publishes SOA records. Previously it did not.

* SRV records are exported as generic tinydns. The primary reason for this is
  that now we don't require the tinydns patch to publish SRV records. Here's a before/after:

    S_caldav._tcp.simerson.net::calendars.simerson.net.:443:100:5:3600::
    :_caldav._tcp.simerson.net:33:\000\005\000\144\001\273\011calendars\010simerson\003net\000:3600::

